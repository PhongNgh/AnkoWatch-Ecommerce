<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products · Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#"><span class="fs-2 text-uppercase">Anko Watch</span></a>
    <button class="navbar-toggler position-absolute d-md-none collapsed mt-1 me-1" type="button" data-bs-toggle="offcanvas"
    data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar" aria-expanded="false" aria-label="Close"
    style="top: 0; right: 0;">
        <span class="navbar-toggler-icon"></span>
    </button>
    <input class="form-control form-control-dark w-100 d-none d-md-block" type="text" placeholder="Search" aria-label="Search">
    <div class="navbar-nav">
        <div class="nav-item text-nowrap">
            <a class="nav-link px-3 d-none d-md-block" href="{{ url_for('logout') }}">Sign out</a>
        </div>
    </div>
</header>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/dashboard">
                            <i class="bi bi-house-door"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/orders">
                            <i class="bi bi-file-earmark"></i>
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/admin/products">
                            <i class="bi bi-cart"></i>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/customers">
                            <i class="bi bi-people"></i>
                            Customers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/reports">
                            <i class="bi bi-bar-chart"></i>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/vouchers">
                            <i class="bi bi-layers"></i>
                            Vouchers
                        </a>
                    </li>
                </ul>
                <!-- <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Saved reports</span>
                    <a class="link-secondary" href="#" aria-label="Add a new report">
                        <i class="bi bi-plus-circle"></i>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Current month
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Last quarter
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Social engagement
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Year-end sale
                        </a>
                    </li>
                </ul> -->
            </div>
        </nav>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/dashboard">
                            <i class="bi bi-house-door"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/orders">
                            <i class="bi bi-file-earmark"></i>
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/admin/products">
                            <i class="bi bi-cart"></i>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/customers">
                            <i class="bi bi-people"></i>
                            Customers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/reports">
                            <i class="bi bi-bar-chart"></i>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/vouchers">
                            <i class="bi bi-layers"></i>
                            Vouchers
                        </a>
                    </li>
                </ul>
                <!-- <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Saved reports</span>
                    <a class="link-secondary" href="#" aria-label="Add a new report">
                        <i class="bi bi-plus-circle"></i>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Current month
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Last quarter
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Social engagement
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-file-text"></i>
                            Year-end sale
                        </a>
                    </li>
                </ul> -->
            </div>
        </div>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Products</h1>
            </div>

            <!-- Danh sách sản phẩm -->
            <div class="d-flex justify-content-between align-items-center">
                <h2>All Products</h2>
                <button type="button" class="btn btn-sm btn-primary float-end" data-bs-toggle="modal" data-bs-target="#addProductModal">
                    <i class="bi bi-plus"></i> Add Product
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th class="text-start">#</th>
                            <th class="text-start">Product ID</th>
                            <th class="text-center">Image</th>
                            <th class="text-center">Name</th>
                            <th class="text-center">Category</th>
                            <th class="text-center">Brand</th>
                            <th class="text-center">Price</th>
                            <th class="text-center">Stock</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if products %}
                        {% for product in products %}
                        <tr>
                            <td class="text-start">{{ loop.index }}</td>
                            <td class="text-start">{{ product._id }}</td>
                            <td class="text-center"><img src="{{ product.image }}" alt="{{ product.name }}" class="img-thumbnail" style="width: 50px; height: 50px;"></td>
                            <td class="text-center">{{ product.name }}</td>
                            <td class="text-center">{{ product.category_names|join(', ') }}</td>
                            <td class="text-center">{{ product.brand_name }}</td>
                            <td class="text-center">{{ "{:,.0f}".format(product.discounted_price) if product.discounted_price is defined else "{:,.0f}".format(product.price) }}đ</td>
                            <td class="text-center">{{ product.quantity }}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editProductModal{{ product._id }}">Edit</button>
                                <form action="{{ url_for('admin_delete_product', product_id=product._id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger btn-delete-product">Delete</button>
                                </form>
                            </td>
                        </tr>

                        <!-- Modal chỉnh sửa sản phẩm -->
                        <div class="modal fade" id="editProductModal{{ product._id }}" tabindex="-1" aria-labelledby="editProductModalLabel{{ product._id }}" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editProductModalLabel{{ product._id }}">Edit Product</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="{{ url_for('admin_update_product', product_id=product._id) }}" method="POST" enctype="multipart/form-data">
                                            <div class="mb-3">
                                                <label for="productName{{ product._id }}" class="form-label">Product Name</label>
                                                <input type="text" class="form-control" id="productName{{ product._id }}" name="name" value="{{ product.name }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productDescription{{ product._id }}" class="form-label">Description</label>
                                                <textarea class="form-control" id="productDescription{{ product._id }}" name="description" rows="3">{{ product.description }}</textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productImage{{ product._id }}" class="form-label">Image</label>
                                                <input type="file" class="form-control" id="productImage{{ product._id }}" name="image">
                                                <small class="form-text text-muted">Current image: <img src="{{ product.image }}" alt="Current Image" style="width: 50px; height: 50px;"></small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productQuantity{{ product._id }}" class="form-label">Quantity</label>
                                                <input type="number" class="form-control" id="productQuantity{{ product._id }}" name="quantity" value="{{ product.quantity }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productPrice{{ product._id }}" class="form-label">Price</label>
                                                <input type="number" class="form-control" id="productPrice{{ product._id }}" name="price" value="{{ product.price }}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productCostPrice" class="form-label">Cost Price (Giá nhập)</label>
                                                <input type="number" class="form-control" id="productCostPrice{{ product._id }}" name="cost_price" value="{{ product.cost_price if product.cost_price is defined else 0 }}" required min="0" step="0.01">
                                            </div>
                                            <div class="mb-3">
                                                <label for="productDiscount{{ product._id }}" class="form-label">Discount (%)</label>
                                                <input type="number" class="form-control" id="productDiscount{{ product._id }}" name="discount" value="{{ product.discount }}" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Size (mm)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control size-input" id="productSize{{ product._id }}" placeholder="Enter size and press Enter">
                                                    <span class="input-group-text">mm</span>
                                                </div>
                                                <div id="sizeList{{ product._id }}" class="mt-2">
                                                    {% for size in product.size %}
                                                    <span class="badge bg-secondary size-item me-1" data-size="{{ size }}">{{ size }}mm <button type="button" class="btn-close btn-close-white btn-sm ms-1 remove-size" aria-label="Remove"></button></span>
                                                    {% endfor %}
                                                </div>
                                                <!-- Hidden inputs for sizes -->
                                                <div id="sizeHiddenInputs{{ product._id }}" class="size-hidden-container">
                                                    {% for size in product.size %}
                                                    <input type="hidden" name="size" value="{{ size }}" class="size-hidden-input">
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productMaterial{{ product._id }}" class="form-label">Material (Chất liệu)</label>
                                                <input type="text" class="form-control" id="productMaterial{{ product._id }}" name="material" value="{{ product.material if product.material is defined else '' }}" placeholder="e.g., Thép không gỉ">
                                            </div>
                                            <div class="mb-3">
                                                <label for="productOrigin{{ product._id }}" class="form-label">Origin (Xuất xứ)</label>
                                                <input type="text" class="form-control" id="productOrigin{{ product._id }}" name="origin" value="{{ product.origin if product.origin is defined else '' }}" placeholder="e.g., Thụy Sĩ">
                                            </div>
                                            <div class="mb-3">
                                                <label for="productTechnology{{ product._id }}" class="form-label">Technology (Công nghệ)</label>
                                                <input type="text" class="form-control" id="productTechnology{{ product._id }}" name="technology" value="{{ product.technology if product.technology is defined else '' }}" placeholder="e.g., Chống nước 50m">
                                            </div>
                                            <div class="mb-3">
                                                <label for="productYear{{ product._id }}" class="form-label">Year of Manufacture (Năm sản xuất)</label>
                                                <input type="number" class="form-control" id="productYear{{ product._id }}" name="year" value="{{ product.year if product.year is defined else '' }}" placeholder="e.g., 2023" min="1900" max="2099">
                                            </div>
                                            <div class="mb-3">
                                                <label for="productCategory{{ product._id }}" class="form-label">Category</label>
                                                <select class="form-control" id="productCategory{{ product._id }}" name="category_id" required>
                                                    <option value="" disabled>Chọn danh mục</option>
                                                    {% for category in categories %}
                                                    <option value="{{ category._id }}" {% if category.name == product.category_names[0] %}selected{% endif %}>{{ category.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="productBrand{{ product._id }}" class="form-label">Brand</label>
                                                <select class="form-control" id="productBrand{{ product._id }}" name="brand_id" required>
                                                    <option value="" disabled>Chọn hãng</option>
                                                    {% for brand in brands %}
                                                    <option value="{{ brand._id }}" {% if brand.name == product.brand_name %}selected{% endif %}>{{ brand.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="9" class="text-center">No products found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Danh sách danh mục -->
            <div class="d-flex justify-content-between align-items-center mt-4">
                <h2>Product Categories</h2>
                <button type="button" class="btn btn-sm btn-primary float-end" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                    <i class="bi bi-plus"></i> Add Category
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th class="text-start">#</th>
                            <th class="text-start">Category ID</th>
                            <th class="text-center">Name</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category in categories %}
                        <tr>
                            <td class="text-start">{{ loop.index }}</td>
                            <td class="text-start">{{ category._id }}</td>
                            <td class="text-center">{{ category.name }}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editCategoryModal{{ category._id }}">Edit</button>
                                <form action="{{ url_for('admin_delete_category', category_id=category._id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger btn-delete-category">Delete</button>
                                </form>
                            </td>
                        </tr>

                        <!-- Modal chỉnh sửa danh mục -->
                        <div class="modal fade" id="editCategoryModal{{ category._id }}" tabindex="-1" aria-labelledby="editCategoryModalLabel{{ category._id }}" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editCategoryModalLabel{{ category._id }}">Edit Category</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="{{ url_for('admin_update_category', category_id=category._id) }}" method="POST">
                                            <div class="mb-3">
                                                <label for="categoryId{{ category._id }}" class="form-label">Category ID</label>
                                                <input type="text" class="form-control" id="categoryId{{ category._id }}" value="{{ category._id }}" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="categoryName{{ category._id }}" class="form-label">Category Name</label>
                                                <input type="text" class="form-control" id="categoryName{{ category._id }}" name="name" value="{{ category.name }}" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Danh sách hãng -->
            <div class="d-flex justify-content-between align-items-center mt-4">
                <h2>Brands</h2>
                <button type="button" class="btn btn-sm btn-primary float-end" data-bs-toggle="modal" data-bs-target="#addBrandModal">
                    <i class="bi bi-plus"></i> Add Brand
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th class="text-start">#</th>
                            <th class="text-start">Brand ID</th>
                            <th class="text-center">Name</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for brand in brands %}
                        <tr>
                            <td class="text-start">{{ loop.index }}</td>
                            <td class="text-start">{{ brand._id }}</td>
                            <td class="text-center">{{ brand.name }}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editBrandModal{{ brand._id }}">Edit</button>
                                <form action="{{ url_for('admin_delete_brand', brand_id=brand._id) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger btn-delete-brand">Delete</button>
                                </form>
                            </td>
                        </tr>

                        <!-- Modal chỉnh sửa hãng -->
                        <div class="modal fade" id="editBrandModal{{ brand._id }}" tabindex="-1" aria-labelledby="editBrandModalLabel{{ brand._id }}" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editBrandModalLabel{{ brand._id }}">Edit Brand</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="{{ url_for('admin_update_brand', brand_id=brand._id) }}" method="POST">
                                            <div class="mb-3">
                                                <label for="brandId{{ brand._id }}" class="form-label">Brand ID</label>
                                                <input type="text" class="form-control" id="brandId{{ brand._id }}" value="{{ brand._id }}" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="brandName{{ brand._id }}" class="form-label">Brand Name</label>
                                                <input type="text" class="form-control" id="brandName{{ brand._id }}" name="name" value="{{ brand.name }}" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Modal thêm sản phẩm -->
            <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('admin_add_product') }}" method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Product Name</label>
                                    <input type="text" class="form-control" id="productName" name="name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="productDescription" name="description" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="productImage" class="form-label">Image</label>
                                    <input type="file" class="form-control" id="productImage" name="image" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productQuantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="productQuantity" name="quantity" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productPrice" class="form-label">Price</label>
                                    <input type="number" class="form-control" id="productPrice" name="price" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productCostPrice" class="form-label">Cost Price (Giá nhập)</label>
                                    <input type="number" class="form-control" id="productCostPrice" name="cost_price" required min="0" step="0.01">
                                </div>
                                <div class="mb-3">
                                    <label for="productDiscount" class="form-label">Discount (%)</label>
                                    <input type="number" class="form-control" id="productDiscount" name="discount" value="0" min="0">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Size (mm)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control size-input" id="productSizeAdd" placeholder="Enter size and press Enter">
                                        <span class="input-group-text">mm</span>
                                    </div>
                                    <div id="sizeListAdd" class="mt-2"></div>
                                    <!-- Hidden input để gửi danh sách size -->
                                    <div id="sizeHiddenInputsAdd" class="size-hidden-container"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="productMaterial" class="form-label">Material (Chất liệu)</label>
                                    <input type="text" class="form-control" id="productMaterial" name="material" placeholder="e.g., Thép không gỉ">
                                </div>
                                <div class="mb-3">
                                    <label for="productOrigin" class="form-label">Origin (Xuất xứ)</label>
                                    <input type="text" class="form-control" id="productOrigin" name="origin" placeholder="e.g., Thụy Sĩ">
                                </div>
                                <div class="mb-3">
                                    <label for="productTechnology" class="form-label">Technology (Công nghệ)</label>
                                    <input type="text" class="form-control" id="productTechnology" name="technology" placeholder="e.g., Chống nước 50m">
                                </div>
                                <div class="mb-3">
                                    <label for="productYear" class="form-label">Year of Manufacture (Năm sản xuất)</label>
                                    <input type="number" class="form-control" id="productYear" name="year" placeholder="e.g., 2023" min="1900" max="2099">
                                </div>
                                <div class="mb-3">
                                    <label for="productCategory" class="form-label">Category</label>
                                    <select class="form-control" id="productCategory" name="category_id" required>
                                        <option value="" disabled selected>Chọn danh mục</option>
                                        {% for category in categories %}
                                        <option value="{{ category._id }}">{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="productBrand" class="form-label">Brand</label>
                                    <select class="form-control" id="productBrand" name="brand_id" required>
                                        <option value="" disabled selected>Chọn hãng</option>
                                        {% for brand in brands %}
                                        <option value="{{ brand._id }}">{{ brand.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal thêm danh mục -->
            <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addCategoryModalLabel">Add Category</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('admin_add_category') }}" method="POST">
                                <div class="mb-3">
                                    <label for="categoryName" class="form-label">Category Name</label>
                                    <input type="text" class="form-control" id="categoryName" name="name" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal thêm hãng -->
            <div class="modal fade" id="addBrandModal" tabindex="-1" aria-labelledby="addBrandModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addBrandModalLabel">Add Brand</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('admin_add_brand') }}" method="POST">
                                <div class="mb-3">
                                    <label for="brandName" class="form-label">Brand Name</label>
                                    <input type="text" class="form-control" id="brandName" name="name" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Xác nhận trước khi xóa sản phẩm
        document.querySelectorAll('.btn-delete-product').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const form = this.closest('form');
                Swal.fire({
                    title: "Bạn có chắc chắn?",
                    text: "Bạn sẽ không thể hoàn tác hành động này!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Vâng, xóa nó!",
                    cancelButtonText: "Hủy"
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });
    
        // Xác nhận trước khi xóa danh mục
        document.querySelectorAll('.btn-delete-category').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const form = this.closest('form');
                Swal.fire({
                    title: "Bạn có chắc chắn?",
                    text: "Bạn sẽ không thể hoàn tác hành động này!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Vâng, xóa nó!",
                    cancelButtonText: "Hủy"
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });
    
        // Xác nhận trước khi xóa hãng
        document.querySelectorAll('.btn-delete-brand').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const form = this.closest('form');
                Swal.fire({
                    title: "Bạn có chắc chắn?",
                    text: "Bạn sẽ không thể hoàn tác hành động này!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Vâng, xóa nó!",
                    cancelButtonText: "Hủy"
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });
    
        // Xử lý trường size cho tất cả modal (cả thêm và chỉnh sửa)
        document.querySelectorAll('.size-input').forEach(input => {
            const sizeList = input.closest('.mb-3').querySelector('[id^="sizeList"]');
            const hiddenInputsContainer = input.closest('.mb-3').querySelector('.size-hidden-container');
            const productId = input.id.replace('productSize', '');
    
            // Xử lý khi nhấn Enter để thêm size
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const sizeValue = input.value.trim();
                    if (sizeValue && !isNaN(sizeValue) && sizeValue > 0) {
                        // Kiểm tra xem size đã tồn tại chưa
                        const existingSizes = Array.from(sizeList.querySelectorAll('.size-item')).map(item => item.dataset.size);
                        if (existingSizes.includes(sizeValue)) {
                            Swal.fire({
                                title: "Lỗi!",
                                text: `Kích thước ${sizeValue}mm đã tồn tại!`,
                                icon: "error",
                                timer: 1500,
                                showConfirmButton: false
                            });
                            return;
                        }
    
                        // Thêm size vào danh sách hiển thị
                        const sizeItem = document.createElement('span');
                        sizeItem.className = 'badge bg-secondary size-item me-1';
                        sizeItem.dataset.size = sizeValue;
                        sizeItem.innerHTML = `${sizeValue}mm <button type="button" class="btn-close btn-close-white btn-sm ms-1 remove-size" aria-label="Remove"></button>`;
                        sizeList.appendChild(sizeItem);
    
                        // Thêm hidden input để gửi size
                        const hiddenInput = document.createElement('input');
                        hiddenInput.type = 'hidden';
                        hiddenInput.name = 'size';
                        hiddenInput.value = sizeValue;
                        hiddenInput.className = 'size-hidden-input';
                        hiddenInputsContainer.appendChild(hiddenInput);
    
                        // Xóa giá trị trong input
                        input.value = '';
    
                        // Thêm sự kiện xóa size
                        sizeItem.querySelector('.remove-size').addEventListener('click', function() {
                            sizeItem.remove();
                            hiddenInput.remove();
                        });
                    } else {
                        Swal.fire({
                            title: "Lỗi!",
                            text: "Vui lòng nhập một kích thước hợp lệ (số dương)!",
                            icon: "error",
                            timer: 1500,
                            showConfirmButton: false
                        });
                    }
                }
            });
    
            // Xử lý xóa size đã có
            sizeList.querySelectorAll('.remove-size').forEach(button => {
                button.addEventListener('click', function() {
                    const sizeItem = button.closest('.size-item');
                    const sizeValue = sizeItem.dataset.size;
                    const hiddenInput = hiddenInputsContainer.querySelector(`input[value="${sizeValue}"]`);
                    sizeItem.remove();
                    if (hiddenInput) hiddenInput.remove();
                });
            });
        });
    
        // Lắng nghe sự kiện HX-Trigger để hiển thị SweetAlert2
        document.body.addEventListener('htmx:afterRequest', function(event) {
            const hxTrigger = event.detail.xhr.getResponseHeader('HX-Trigger');
            if (hxTrigger) {
                const triggers = JSON.parse(hxTrigger);
                if (triggers.showAlert) {
                    const { title, message, icon } = triggers.showAlert;
                    Swal.fire({
                        title: title,
                        text: message,
                        icon: icon,
                        timer: 1500,
                        showConfirmButton: false,
                        timerProgressBar: true
                    });
                }
            }
        });
    });
    </script>
    <script>
    (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9275a559eb4a1d78',t:'MTc0MzE0OTM3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
    <script>
    (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'927601461b22bfe8',t:'MTc0MzE1MzEzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
    <script>
    (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'928d4fa539161353',t:'MTc0MzM5NzUyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
    </script>
    <script src="{{ url_for('static', filename='js/token-handler.js') }}"></script>
</body>
</html>